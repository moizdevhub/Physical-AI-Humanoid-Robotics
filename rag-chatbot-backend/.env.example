# ======================================================
# RAG Chatbot Backend - Environment Configuration (T068)
# ======================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!

# ===== REQUIRED: Embedding Service =====
# Cohere API for generating 1024-dim text embeddings
# Get your key: https://dashboard.cohere.com/api-keys
# Free tier: 100 API calls/month (sufficient with semantic caching)
# Model used: embed-english-v3.0
COHERE_API_KEY=your_cohere_key_here

# ===== REQUIRED: LLM Generation Service =====
# Google Gemini API for answer synthesis
# Get your key: https://ai.google.dev/
# Free tier: 60 requests/minute
# Model used: gemini-1.5-flash or gemini-1.5-pro
GEMINI_API_KEY=your_gemini_key_here

# ===== REQUIRED: Vector Database =====
# Qdrant Cloud for semantic search
# Get your cluster: https://cloud.qdrant.io/
# Free tier: 1GB storage, 100 API calls/day
# Format: https://your-cluster-id.us-east-1-0.aws.cloud.qdrant.io:6333
# Production: Use dedicated cluster for better performance
QDRANT_URL=https://your-cluster.qdrant.cloud:6333
QDRANT_API_KEY=your_qdrant_key_here

# ===== REQUIRED: Relational Database =====
# Neon Postgres for conversations, sessions, analytics
# Get your database: https://neon.tech/
# Free tier: 512MB storage, 0.5GB data transfer
# Format: postgresql://username:password@host/database
# Production: Enable connection pooling, use dedicated database
NEON_DATABASE_URL=postgresql://user:pass@host/db

# ===== OPTIONAL: Cache Layer =====
# Redis for semantic caching and rate limiting
# Local development: redis://localhost:6379
# Production: Use managed Redis (Upstash, Redis Cloud, AWS ElastiCache)
# Free tier: Upstash (10k commands/day)
# Performance impact: 70%+ cache hit rate reduces API costs
REDIS_URL=redis://localhost:6379

# ===== OPTIONAL: Security =====
# JWT secret key for session tokens
# Production: Generate with: python -c "import secrets; print(secrets.token_hex(32))"
# Keep this secret! Rotate periodically.
SECRET_KEY=your_jwt_secret_here

# ===== OPTIONAL: CORS Configuration =====
# Allowed origins for CORS (comma-separated)
# Development: http://localhost:3000
# Production: https://yourbook.com,https://www.yourbook.com
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# ===== OPTIONAL: Application Configuration =====
# Environment: development | staging | production
# Affects logging, error handling, debug mode
ENVIRONMENT=development

# Logging level: DEBUG | INFO | WARNING | ERROR | CRITICAL
# Development: INFO or DEBUG
# Production: WARNING or ERROR (less verbose)
LOG_LEVEL=INFO

# ===== PRODUCTION NOTES =====
# 1. API Key Security:
#    - Store in secure secret management (AWS Secrets Manager, HashiCorp Vault)
#    - Never log API keys
#    - Rotate keys regularly
#
# 2. Database:
#    - Use connection pooling (configured in dependencies.py)
#    - Enable SSL for production (add ?sslmode=require to NEON_DATABASE_URL)
#    - Run migrations before deployment: python scripts/migrate_db.py
#
# 3. Caching:
#    - Redis highly recommended for production (70%+ cache hit rate)
#    - Configure eviction policy: allkeys-lru
#    - Monitor cache hit rate via /health endpoint
#
# 4. Rate Limiting:
#    - Per-user: 10 requests/minute (adjust in middleware/rate_limiter.py)
#    - Per-IP: 30 requests/minute
#    - Qdrant free tier: 100 calls/day (semantic caching keeps you under limit)
#
# 5. Performance:
#    - Cached queries: <2s p95 latency
#    - Non-cached: <5s p95 latency
#    - Concurrent users: 50+ supported
#
# 6. Monitoring:
#    - Health check: GET /health
#    - Metrics: cache hit rate, query latency, error rates
#    - Logs: JSON format (structured logging enabled)
#
# 7. Deployment:
#    - Use Docker (see Dockerfile, docker-compose.yml)
#    - Set workers based on CPU: workers = (2 * num_cores) + 1
#    - Enable graceful shutdown: timeout-graceful-shutdown=30
#
# 8. Book Content Ingestion:
#    - Run before first deploy: python scripts/ingest_book.py
#    - Validate embeddings: python scripts/validate_embeddings.py
#    - Expected: 200-page book â†’ 200 chunks in <10 minutes
#
# 9. Backup & Recovery:
#    - Backup Qdrant collections monthly
#    - Backup Postgres conversations daily
#    - Test restore procedure quarterly
